# Rust 替代 KILLER 系统开发清单（非 MVP 版）

> 用 Rust 微服务完整替代 KILLER 的开发波次与模块级交付清单。顺序基于《README-项目文档导航.md》里的文档依赖（先读架构/计划/模块列表），覆盖架构设计文档 2.2 的 15 个服务并补充主数据与平台层。

## 开发波次与顺序
| 序号 | 模块/服务 | 覆盖的 KILLER 范围 | 主要依赖 | 关键输出 |
|-----|-----------|-----------------|----------|----------|
| 0 | 平台与主数据治理（MDG/GRC/IAM） | 主数据、身份、组织、合规 | 基础设施 | API 网关、统一身份、业务伙伴/物料/科目主数据、审计与权限 |
| 1 | 财务会计 FI | FI-GL/AP/AR/AA/BL/LC/TV | 0 | 会计科目表、凭证处理、月结/年结、税务与多币种 |
| 2 | 资金与财务供应链 TR/FSCM | TR-CM/TM/MRM、FSCM-CR/CM/DM/BRF | 1 | 现金池与头寸、流动性预测、信用/催收/争议、对冲与定价、付款运行 |
| 3 | 管理会计 CO | CO-OM/CCA/OPA/ABC、CO-PC/PCP/OBJ/ACT、CO-PA | 1 | 成本中心/要素、内部订单、标准成本/实际成本、获利分析 |
| 4 | 物料与采购 MM | MM-PUR/RFQ/PO/CON、MM-IM/GR/GI/PI、MM-IV、MM-CBP | 0,1 | 采购到付款流程、库存流水、发票三单匹配、补货策略 |
| 5 | 销售与分销 SD | SD-BF/MD/SLS/SHP/BIL/CAS | 4,1 | 报价/订单、定价引擎、交付/装运、开票、信用检查 |
| 6 | 生产计划 PP | PP-BD/SOP/MPS/MRP/CRP/SFC/PI、PP/DS | 4,5,3 | BOM/工艺路线、主生产计划、MRP、产能/排程、车间执行 |
| 7 | 仓储管理 WM/EWM | WM-IM/LT/RF、EWM Labor/Slotting/Yard/Cross-Docking/VAS/Wave | 4,6 | 库位/波次/库内作业、RF 作业、越库/增值服务、场站管理 |
| 8 | 运输管理 TM | TM-PLN/FRE/MON | 5,7 | 运输计划、承运商协同、运费结算、在途跟踪 |
| 9 | 质量管理 QM | QM-PT/QI/CA/QN | 4,6,7 | 检验计划、检验批/结果、质量通知、质量证书、SPC |
| 10 | 设备维护 PM | PM-EQM/WOC/PRM/IS | 4,6,3 | 设备台账、维护计划、工单流转、备件管理、成本归集 |
| 11 | 供应链计划 SCM/IBP | IBP S&OP/Demand/Supply/Inventory/Response | 5,6,7 | 需求/供应计划、库存优化、响应与供应、共识计划 |
| 12 | 项目系统 PS | PS-BD/PLN/EXE/REV | 1,3 | WBS/网络、预算与承诺、进度/成本控制、收入确认 |
| 13 | 人力资本 HCM | PA/OM/PD/TM/PY/BN、ESS/MSS、SuccessFactors | 0,1 | 组织与职位、考勤、薪资核算、福利、绩效/招聘/培训 |
| 14 | 客户关系与服务 CRM/CX | CRM、C4C/CX Sales/Service/Marketing/Commerce、FSM | 5,7 | 客户主数据、商机/活动、服务工单/现场服务、全渠道交互 |
| 15 | 分析与报表 BI/BW | BW/4HANA、SAC、数据仓库/报表 | 1-14 | 主题域数据仓库、语义模型、财务/供应链/HR/CRM 报表与仪表盘 |

## 模块开发清单

### 0. 平台与主数据治理（MDG/GRC/IAM）
- 领域范围：业务伙伴（客户/供应商）、物料主数据、科目表、组织与成本/利润中心、税码/币种/UoM、角色与职责分离。
- 业务能力：主数据建模/版本/审批、重复检测与合并、批量导入与变更日志、数据质量规则、跨服务事件分发、参考数据服务（枚举/代码表）。
- 平台能力：统一身份/SSO、RBAC/ABAC、API 网关、配置中心、审计追踪、加密与密钥管理、日志/指标/追踪基线。
- 数据集成：初始数据迁移管道、与 FI/MM/SD/HR 的主数据同步、主数据订阅与缓存、主数据变更溯源。
- 测试与验收：主数据全量/增量对账、权限模型渗透测试、数据质量 KPI（唯一性、完整性、一致性）、高可用/备份恢复演练。

### 1. 财务会计（FI）
- 领域范围：FI-GL、应收应付、固定资产、银行分类账、差旅、合并。
- 业务能力：多会计准则与多币种账簿、凭证录入与过账、自动分录模板、期间/年度结账、税务与预提、资产生命周期/折旧、支付运行与催款。
- 数据与集成：与 MM/SD 对账（GR/IR、开票）、与 TR 共享银行与现金流水、与 HR 工资分录、外部报税接口。
- 报表：资产负债表、利润表、现金流量表、账龄、税务申报、审计日志/凭证影像。
- 控制与合规：审批流、权限分离、影像归档、对账差异处理、审计可追溯性、会计政策配置。
- 测试与迁移：平行账簿双账验证、期初余额导入、关账性能（批量结账）、支付批次演练。

### 2. 资金与财务供应链（TR/FSCM）
- 领域范围：现金管理、流动性计划、交易管理（外汇/利率/衍生品）、信用管理、催收、争议处理、直接计费。
- 业务能力：现金池与资金集中、头寸管理、银行对账、付款工厂、信用额度/评分、催收策略、争议案件生命周期、市场数据定价、套期会计。
- 集成：与 FI 共享银行账户/过账、与 AR/AP 付款/收款、接口银行/Swift/银企直连、风险指标推送至 BI。
- 报表与监控：流动性预测、现金流滚动、信用暴露、对冲效果评估、DSO/DPO。
- 合规：限额与审批、职责分离、交易日志留存、KYC/AML 钩子。

### 3. 管理会计（CO）
- 领域范围：成本中心/要素、内部订单、作业成本法、产品成本控制（计划/实际）、盈利能力分析（CO-PA）。
- 业务能力：标准成本/实际成本核算、分摊/分配/分摊循环、成本对象控制、WIP/差异结转、利润中心分析。
- 集成：与 FI 过账、与 PP/SD/PM 取成本、与 PS/HR 的成本归集、成本与利润维度对齐。
- 报表：成本中心/内部订单报表、成本差异分析、盈利能力分段（客户/产品/渠道）。
- 控制：版本与预算控制、成本锁定策略、结算规则配置、结算批处理监控。

### 4. 物料与采购（MM）
- 领域范围：寻源/RFQ、采购申请/订单/合同、供应商管理、库存管理（GR/GI/转储/盘点）、发票校验、消耗型补货。
- 业务能力：采购到付款全链路、价格与条件合同、三单匹配、批次/序列号、质量阻断库存、寄售/委外、自动补货策略。
- 集成：与 FI/CO 过账、与 QM 质检、与 WM/EWM 库内作业、与 SRM/Ariba 的目录/PO/发票接口。
- 报表：采购周期/准时率、供应商评分、库存周转/安全库存、价格变动分析。
- 控制：审批流、分段权限、供应商资质与黑名单、采购限制（金额/品类）、盘点差异处理。

### 5. 销售与分销（SD）
- 领域范围：主数据（客户/物料/定价）、询价/报价/销售订单、交付/装运、计费/开票、信用检查、销售支持。
- 业务能力：多层定价/折扣/促销、可承诺量/可供日期（ATP）、分销渠道与合作伙伴模型、退货/换货、部分发货与部分开票、对账单与收款对照。
- 集成：与 MM 库存与出库、与 FI/CO 开票与收入确认、与 TM/WM 配送、与 CRM 营销/服务。
- 报表：销售漏斗、订单履约率、毛利/净利、信用暴露、退货率。
- 控制：审批、信用限额、价格保护、税务与合规校验、电子发票接口。

### 6. 生产计划（PP）
- 领域范围：BOM/工艺路线、S&OP、主生产计划、MRP、产能计划、车间执行、流程工业（批次/配方）、高级排程（PP/DS）。
- 业务能力：需求驱动/库存驱动计划、MRP 运算与例外、生产订单/工单、派工与反馈、批次管理与追溯、替代料/并行/交叉工序、排程约束（产能/物料/工具）。
- 集成：与 MM/SD 需求、与 CO 成本核算、与 QM/PM 检验与维护、与 WM/EWM 领料/回库。
- 报表：计划达成率、生产周期、在制品、工序效率、物料齐套率。
- 控制：版本化 BOM/工艺、变更管理、锁定规则、生产审批/签字、异常处置流程。

### 7. 仓储管理（WM/EWM）
- 领域范围：库存地点/库位、上架/拣货/移库、波次/任务管理、RF/条码、越库、增值服务、库位优化/Slotting、劳动力管理、场站管理。
- 业务能力：入库（PO/生产/退货）、出库（销售/生产领料/调拨）、波次/批次策略、托盘/包装、RF 作业指引、装卸/门禁、越库与直通流程。
- 集成：与 MM/SD/PP/PM 的库存交易、与 TM 装运、与 QM 检验点、与设备/自动化接口（可选）。
- 报表：库龄、拣货效率、盘点差异、场站吞吐、劳动力利用率。
- 控制：作业分配策略、权限到仓/库位、异常库存隔离、安全/合规检查。

### 8. 运输管理（TM）
- 领域范围：运输计划、承运商协同、运价与合同、运费结算、在途监控。
- 业务能力：路线/装载优化、多段多式联运、承运商招投标与分配、运价计算、提/派车、签收与 POD、异常与索赔、碳排放核算。
- 集成：与 SD/WM 交付、与 FI 结算、与外部 TMS/承运商 API、地图/轨迹服务。
- 报表：运输成本、准时率、装载率、异常率、碳排放。
- 控制：运价版本、审批、黑名单承运商、GPS/事件签名校验。

### 9. 质量管理（QM）
- 领域范围：质检计划、检验批与结果、质量通知、质量证书、统计过程控制。
- 业务能力：来料/过程/出货/库存转移检验，取样方案与判定规则，缺陷记录与处置，质量阻断与放行，证书生成与回溯。
- 集成：与 MM/WM 入库检验、与 PP 在制检验、与 SD 出货检验、与 PM 质量反馈、与供应商/客户门户共享质量数据。
- 报表：合格率、缺陷趋势、供应商质量、成本（COPQ）、SPC 控制图。
- 控制：检验版本、审批与签字、批次追溯、CAPA 闭环。

### 10. 设备维护（PM）
- 领域范围：设备与功能位置、维护计划/策略、通知与工单、预防性/预测性维护、备件与工时。
- 业务能力：故障/预防/改造工单流程，维护包与计划排程，备件需求与领用，计量点与抄表，成本归集与结算。
- 集成：与 MM/WM 备件、与 CO/FI 成本、与 QM 质量反馈、与 IoT/传感器（可选）、与 HR 工时。
- 报表：MTBF/MTTR、计划 vs 实际、备件消耗、停机损失。
- 控制：审批/锁定、安全许可、技术对象版本与历史、工单审计。

### 11. 供应链计划（SCM/IBP）
- 领域范围：S&OP、需求计划、供应计划、库存优化、响应与供应。
- 业务能力：统计/因果/AI 预测、需求协同、分层计划、约束型供应计划、部署与再平衡、库存定位/安全库存、情景与假设分析、供应响应与重计划。
- 集成：与 SD 需求、与 PP/WM/ TM 执行反馈、与 FI/CO 成本、数据仓库共享计划版本。
- 报表：预测准确度、履约率、库存周转/缺货率、计划偏差。
- 控制：计划版本管理、审批、警戒线/例外管理、主数据一致性校验。

### 12. 项目系统（PS）
- 领域范围：WBS/网络计划、里程碑、预算/承诺、成本/收入、物料/工时。
- 业务能力：项目模板、预算控制/冻结、采购/生产/工时集成、进度与挣值、收入确认（完工百分比/完工合同）、变更与索赔。
- 集成：与 FI/CO 成本与结算、与 MM/SD/PP 的需求、与 HR 工时、与 CRM 商机→项目交接。
- 报表：进度偏差、成本偏差、现金流、里程碑达成、合同毛利。
- 控制：版本与基线、审批门、授权到 WBS 层、风险登记册。

### 13. 人力资本管理（HCM）
- 领域范围：组织/职位、员工主数据、时间/考勤、薪资、福利、绩效、招聘/入职、培训、员工/经理自助。
- 业务能力：合同/异动、排班与加班、薪资核算与分摊、社保/税务、绩效与目标、继任与发展、培训计划、移动/自助入口。
- 集成：与 FI/CO 薪资分录、与 PS/PM 工时、与门禁/考勤设备、可选对接 SuccessFactors。
- 报表：员工成本、离职率、出勤率、薪酬结构、培训/绩效指标。
- 控制：隐私与合规（GDPR 等）、角色隔离、薪资保密、审计与留痕。

### 14. 客户关系与服务（CRM/CX）
- 领域范围：客户主数据与 360 视图、商机/线索、营销活动、合同、服务请求/工单、现场服务、全渠道（Web/电话/邮件/社交）、电商（可选）。
- 业务能力：潜客评分、活动编排、报价与合同、SLA 与排班、工单派发与现场服务、知识库、自助门户、退换/保内保外、客户同意与偏好管理。
- 集成：与 SD 订单/配送、与 FI/CO 账单与应收、与 TM/WM 物流状态、与 HR 排班、与外部渠道/联络中心。
- 报表：销售漏斗、活动 ROI、客户满意度/CSAT/NPS、服务水平达成、续约/流失。
- 控制：隐私/同意、通话/聊天记录留存、SLA 配置、多渠道身份统一。

### 15. 分析与报表（BI/BW）
- 领域范围：企业数据仓库、语义模型、指标与报表、仪表盘、自助分析、数据质量与血缘。
- 业务能力：主题域数据模型（财务/供应链/生产/HR/CRM）、批/流式 ETL、主数据对齐、历史快照、预算 vs 实际、预构建 KPI 库、权限到指标/列。
- 集成：从 0-14 模块采集事件与批量数据、与 Kafka/CDC、与外部 BI（SAC/PowerBI）、数据服务 API。
- 运营：数据质量规则、作业调度与重试、成本与性能优化、容量规划、备份/灾备。
- 报表交付：法定报表、管理报表、实时运营看板、移动/订阅、异常告警。

---
- 用法：每个模块在进入开发前，结合《Rust-DDD-微服务架构最佳实践.md》《Rust-ERP系统架构设计文档.md》《Rust-ERP系统API设计文档.md》细化到用例/接口/事件；完成功能、集成、报表、合规与性能验证后再进入下一波次。确保非 MVP 覆盖：业务闭环、合规可用、可观测与运维就绪、数据质量与迁移完成。

## 通用模块交付检查清单（适用于 0-15）
- 领域与流程：限界上下文、核心用例、状态机/生命周期、异常场景、审批流。
- 数据模型与元数据：主/交易/参考数据建模，版本与变更，历史快照，数据血缘。
- API/gRPC 与事件：REST/gRPC 契约、错误码、鉴权/鉴别；领域事件、集成事件、重试/幂等、事件溯源。
- 规则与工作流：定价/税务/信控/合规模型，规则引擎配置与灰度发布。
- 集成：跨服务调用矩阵，外部系统接口（银行/税务/物流/设备），批处理与实时链路。
- 主数据与迁移：对齐 MDG 模式，初始/增量迁移，校验与回滚，双写/只读切换策略。
- 报表与数据产品：运营报表、法定报表、管理看板，自助分析语义层，数据可见性权限。
- 权限与合规：RBAC/ABAC、职责分离、审计日志、留存周期、隐私与同意管理。
- 可观测性与 SRE：指标/日志/追踪基线，SLI/SLO，告警路由，灰度/熔断/限流。
- 性能与容量：基准与压测场景、容量模型、缓存/分片策略、批处理窗口。
- 测试策略：单元/契约/集成/端到端/回归，金丝雀数据集，测试数据脱敏。
- 数据质量：完整性/唯一性/一致性/及时性规则，DQ 告警与补救流程。
- 运维与自动化：CI/CD、数据库迁移脚本、回滚/热修、作业调度与重试、运行手册。
- 文档与培训：ADR、接口与事件清单、运维 Runbook、用户手册、培训材料。
- Cutover 与 Rollout：黑暗发布/灰度/全量切换步骤、回滚方案、业务验收/双轨期支持。

## 首三波次详细任务包
### 波次 0：平台与主数据治理（MDG/GRC/IAM）
- 身份与访问：OIDC/OAuth2、单点登录、RBAC/ABAC、职责分离校验、中台级权限缓存。
- 主数据域：业务伙伴/物料/科目/组织/成本利润中心/币种与税码/UoM；重号检测、合并、版本与审批。
- 平台基线：API 网关（限流/签名/审计）、配置中心、密钥管理、日志/指标/追踪三件套。
- 事件与同步：主数据变更事件规范、下游订阅（FI/MM/SD/HR）、幂等与重放、缓存一致性策略。
- 迁移与质量：初始导入工具、数据质量规则与评分、对账与抽样验收、备份恢复演练。

### 波次 1：财务会计（FI）
- 账簿与科目表：多会计准则/多币种账簿、科目主数据管理、维度与分段控制。
- 凭证与过账：凭证模板、分录引擎、税务计算、影像与附件、冲销与调账、期末/年度结账。
- 子账：AR/AP 账龄、付款条件、催款策略；资产卡片、折旧键、资产转移/报废/减值。
- 资金接口：与银行/银企直连付款批次、对账单导入；与 TR 的现金池共享。
- 报表与合规：财务三大表、账龄/税表、审计跟踪、留存策略、合规参数配置。
- 测试与性能：批量凭证过账性能、关账批处理窗口、付款运行回归、期初余额导入与双账验证。

### 波次 2：资金与财务供应链（TR/FSCM）
- 现金与流动性：现金池、头寸、预测模型、限额控制、付款工厂配置。
- 信用与催收：额度模型与评分、授信审批、放行检查、催收策略与工作队列、争议案件闭环。
- 交易管理：外汇/利率/衍生品交易生命周期、定价与市值、会计处理与套期会计。
- 集成：与 FI/AP/AR 的付款/收款过账、银行接口（对账/指令/回执）、市场数据源接入。
- 报表：流动性滚动预测、现金流差异、信用暴露、DSO/DPO、对冲效果。
- 风控与合规：KYC/AML 钩子、审批与双人复核、日志与留存。

### 波次 3：管理会计（CO）
- 成本建模：成本中心/要素主数据、内部订单模板、活动类型与作业率、版本与期间控制。
- 标准成本：成本估算、BOM/工艺取数、标准价发布、成本组件拆分、替代料与成本核算变式。
- 实际成本与结算：作业分配/分摊/分配循环、成本对象控制、在制品与差异、结算规则（FI/CO/PS/资产）。
- 盈利能力分析：CO-PA 维度模型（客户/产品/区域/渠道）、盈利性分段、报告配置、与 FI/SD 对齐。
- 集成：与 PP/SD/PM 的成本取数，与 FI 凭证一致性校验，与 PS/HR 工时分摊。
- 绩效与测试：月结批处理性能、差异计算正确性、利润中心与 CO-PA 对账、版本锁与回滚。

### 波次 4：物料与采购（MM）
- 寻源与采购：供应商主数据/资格、RFQ/报价、采购申请→订单→合同，价格条件与有效期，招投标可选。
- 库存与仓储接口：GR/GI/转储、批次/序列号、质量阻断、盘点/差异、寄售/委外流程。
- 发票与三单匹配：PO/收货/发票自动匹配，容差规则，未清项处理，借贷调整。
- 补货策略：消耗型补货、再订货点、VMI/寄售、计划交期与供应商绩效。
- 集成：与 FI/CO 过账，与 QM 检验触发，与 WM/EWM/PP 的库存与领退料，与 Ariba/SRM 接口可选。
- 报表：采购周期/准时率、价格变动、供应商评分、库存周转与安全库存、发票差异。

### 波次 5：销售与分销（SD）
- 主数据与定价：客户/物料/合作伙伴角色、定价条件/折扣/促销、税务与信用检查前置。
- 订单全链路：询价/报价/销售订单、可承诺量/可供日期（ATP）、部分发货/部分开票、退换/拒收。
- 交付与装运：拣配/包装/装运单、发运与签收、对接 TM/WM/EWM，运费计费与分摊。
- 计费与对账：开票类型（发票/贷项/借项/预收）、对账单、收款对照，收入确认入口。
- 集成：与 FI/CO 开票与收入确认、与 TM 运费、与 CRM/CX 商机→订单、与库存与生产的可用性。
- 报表与控制：履约率、毛利/净利、信用暴露、退货率，审批与价格保护、税务与电子发票接口。

### 波次 6：生产计划（PP）
- 主数据：BOM/工艺路线/工作中心/能力类别，替代料、并行/交叉工序，版本与变更控制。
- 计划与排程：S&OP 对接、主生产计划、MRP 运算与异常、能力需求计划、PP/DS 高级排程。
- 执行：生产订单/工单、派工/报工、报废与返工、产出与副产品、批次追溯、看板/拉动（可选）。
- 物料与成本：领料/退料、回库、替代料；与 CO 成本对象、标准/实际成本链接。
- 质量与维护接口：在制检验触发 QM，设备与工装可用性对接 PM，异常与停机反馈。
- 报表：计划达成率、在制品、工序效率、齐套率、产能利用；控制：锁单/审批、版本化、异常处置。

### 波次 7：仓储管理（WM/EWM）
- 库位与主数据：仓库/库位/HU/包装规格、波次模板、作业类型与策略、Slotting 规则。
- 作业与任务：收货上架、拣货/集货/包装、移库、盘点，RF/条码作业指引，波次与任务分配。
- 进出流程：越库、交叉转运、增值服务（VAS）、场站/门禁/排队、装卸与发运交接。
- 集成：与 MM/SD/PP/PM/QM 的业务事件，与 TM 运输计划/装运，对接自动化设备接口（可选）。
- 绩效与可观测：库龄/拣货效率/波次完成率/盘点差异，任务 SLA 告警；安全/权限到仓/库位。

### 波次 8：运输管理（TM）
- 计划与优化：路线/装载优化，多段/多式联运，订单整合与拆分，约束（时间窗/容量/成本）。
- 承运商协同：招投标/分配、运价与合同、绩效与黑名单、电子回单与 POD。
- 执行与结算：派车/调度、在途跟踪、异常/索赔、运费计算与分摊、对接 FI 结算。
- 集成：与 SD/WM 装运单、与地图/轨迹服务、与外部 TMS/承运商 API。
- 报表：运输成本/准时率/装载率/异常率/碳排放；控制：运价版本、审批、事件签名校验。

### 波次 9：质量管理（QM）
- 计划与采样：检验计划、特性与限度、采样方案、检验点与触发。
- 执行与结果：检验批、缺陷记录、判定与处置、阻断与放行、质量证书生成。
- 通知与CAPA：质量通知、根因分析、纠正预防措施闭环，与供应商/客户反馈接口。
- 集成：与 MM/WM 入库检验、PP 在制检验、SD 出货检验、PM 质量反馈。
- 报表：合格率、缺陷趋势、供应商质量、SPC 控制图、COPQ；控制：签字与审批、批次追溯。

### 波次 10：设备维护（PM）
- 技术对象：设备/功能位置/装置结构，计量点与抄表，版本与历史。
- 维护策略：预防性计划、计划包与生成规则、预测性维护（可与 IoT 接入）、安全许可与票据。
- 通知与工单：故障/改造/预防工单，计划/排程、工时与备件、验收与关闭。
- 集成：与 MM/WM 备件、与 CO/FI 成本结算、与 QM 质量反馈、与 HR 工时。
- 报表：MTBF/MTTR、计划 vs 实际、备件消耗、停机损失；控制：审批、锁定、审计与安全。

### 波次 11：供应链计划（SCM/IBP）
- 需求：统计/因果/ML 预测、协同、分层与细分、异常与促销处理。
- 供应与库存：约束型供应计划、分配与承诺、部署与再平衡、安全库存与库存优化。
- 响应与重计划：事件驱动重计划、供应响应、情景模拟与版本管理、共识计划。
- 集成：与 SD 需求、PP/WM/TM 执行反馈、FI/CO 成本，数据仓库同步计划版本。
- 报表：预测准确度、履约率、库存周转/缺货率、计划偏差；控制：版本审批、主数据一致性。

### 波次 12：项目系统（PS）
- 结构与基线：WBS/网络/里程碑，模板与版本，基线与变更管理。
- 预算与承诺：预算冻结/解锁、承诺控制、预警与审批。
- 执行与成本：采购/生产/工时/费用集成，挣值分析，收入确认（完工百分比/完工合同）。
- 集成：与 FI/CO 成本结算、与 MM/SD/PP 需求执行、与 HR 工时、与 CRM 商机交接。
- 报表：进度/成本偏差、现金流、里程碑达成、合同毛利；控制：授权到 WBS 层、风险登记。

### 波次 13：人力资本管理（HCM）
- 主数据与组织：组织/职位、员工主数据、合同与异动、排班与加班。
- 时间与薪资：考勤与请假、工时、薪资核算与分摊、社保/税务接口、薪资密钥与保密。
- 人才与绩效：招聘与入职、培训与学习、绩效与目标、继任与发展、员工/经理自助。
- 集成：与 FI/CO 薪资分录、与 PS/PM 工时、与门禁/考勤设备、对接 SuccessFactors 可选。
- 合规与隐私：同意与隐私、数据留存与删除、角色隔离、审计与追踪。

### 波次 14：客户关系与服务（CRM/CX）
- 销售与营销：线索/商机/活动、评分与分配、报价与合同、全渠道触达与偏好管理。
- 服务与现场：服务请求/工单、SLA/排班、派工与现场服务、知识库与自助门户、保内/保外/索赔。
- 全渠道与电商：电话/邮件/社交/IM/小程序，电商订单（可选），统一客户视图与身份。
- 集成：与 SD 订单与配送、与 FI/CO 账单与应收、与 TM/WM 物流状态、与 HR 排班。
- 报表：漏斗、活动 ROI、客户满意度/CSAT/NPS、SLA 达成、续约/流失；控制：隐私/同意、记录留存。

### 波次 15：分析与报表（BI/BW）
- 数据获取：CDC/事件总线、批量 ETL、准实时链路、数据质量校验与重试。
- 模型与语义：主题域数据模型（财务/供应链/生产/HR/CRM）、历史快照、主数据对齐、语义层与权限。
- 报表与数据产品：法定报表、管理报表、运营看板、自助分析、移动/订阅、异常告警。
- 运营与治理：DQ 规则、血缘与影响分析、作业编排、成本/性能优化、备份与灾备。
- 接口：数据服务 API、对接 SAC/PowerBI/第三方 BI。

## 后续波次重点交付提示
- 波次 3（CO）：标准/实际成本、作业分配、内部订单、利润分析，成本结算批次与差异处理性能。
- 波次 4-6（MM/SD/PP）：P2P/O2C/MTS-MTO 全链路，MRP/排程/ATP，价格与定价引擎，三单匹配与库存齐套、工单与车间执行。
- 波次 7-8（WM/EWM/TM）：库内作业/波次/RF/场站，运输计划与运费结算、在途跟踪，与 SD/PP/FI 深度耦合的库存与物流事件一致性。
- 波次 9-10（QM/PM）：检验计划与批次、CAPA 闭环、质量阻断；维护计划/工单、备件与停机损失、IoT 预测性维护可选。
- 波次 11（SCM/IBP）：预测/供应/库存优化、情景规划、计划版本治理，与执行层的反馈闭环。
- 波次 12（PS）：WBS/预算/承诺、挣值、收入确认、合同变更与索赔、跨模块成本/物料/工时集成。
- 波次 13-14（HCM/CRM/CX）：薪资/考勤/绩效/招聘与隐私合规；商机/营销/服务/全渠道与现场服务。
- 波次 15（BI/BW）：主题域数仓、CDC/事件采集、语义层与权限、法定与管理报表、成本/性能/数据质量运营。

## 跨模块关键事件与接口基线
- P2P（采购到付款）：PR/RFQ/PO 创建→发布→变更事件；收货（GR）、发票（MIRO/三单匹配）、付款批次与回执；供应商主数据同步；价格/合同变更事件。
- O2C（订单到收款）：询价/报价/销售订单→交付/装运→开票→收款→退换；信用检查与放行事件；ATP/可用量查询接口；运费计费/分摊事件；电子发票/税控接口。
- MTS/MTO/生产：MRP 需求与异常、生产订单/工单状态、领退料、报工、报废/返工、批次与追溯事件；在制检验触发；成本结算事件。
- 仓储/运输：波次/任务生成、上架/拣货/移库/盘点、场站/门禁、运输计划/派车/在途/签收、POD 事件；与 TM 运价/承运商接口；RF 扫描校验。
- 财务/成本：凭证过账、资产变动、关账状态、成本分摊/结算、CO-PA 分段；TR 付款/对账、市场数据；税务/报税接口。
- 主数据：业务伙伴/物料/科目/组织/税码/UoM 变更事件，版本/生效日期，去重与合并；缓存失效策略。
- 分析与数仓：事件总线与 CDC 采集规范、重放与幂等键、Schema 演进与版本化、血缘元数据推送。

## 数据迁移与切换策略要点
- 范围与优先级：主数据先行（BP/物料/科目/组织），再迁交易/历史（按模块波次分批）；识别只读/只写/双写阶段。
- 工具与校验：抽取-清洗-映射脚本、样本对账、全量对账四维度（数量/完整性/准确性/一致性），抽样凭证/订单/库存/薪资/资产核对。
- 双轨与回滚：灰度切换（暗发布→灰度→全量），双账/双轨对比，回滚预案（数据回滚/流量回切/配置回滚）。
- 冻结窗口：切换前冻结主数据与关键交易（短窗口），切换后解冻策略，冲突解决流程。
- 合规与安全：数据脱敏、传输加密、访问审计、留存与销毁计划。

## 性能与容量基准建议（起步指标，可按业务调优）
- API/事件：核心写接口 p99 < 200-300ms，读接口 p99 < 150-200ms；Kafka 事件处理滞留 < 1 分钟；幂等键覆盖 ≥ 99%。
- 批处理：关账/成本结算/三单匹配/运费结算批次在可接受窗口内（示例：关账夜间 2-4h；MRP/IBP 夜间批 < 2h），失败可重试与断点续跑。
- 容量：按峰值 QPS/并发与日订单/凭证量预估，预留 30-50% 余量；缓存命中率目标 > 85%；数据库读写分离与分片策略准备。
- 可用性：核心链路（身份、主数据、FI、订单、库存）目标 99.9%+；关键队列堆积告警、回压与限流策略到位。
- 可观测：三类黄金指标（RED/USE）、业务 SLI（履约率、三单匹配成功率、MRP/ATP 准确度、薪资计算成功率、信用放行 SLA 等）纳入监控。

## 波次验收模板（进入下一波次前必须满足）
- 功能闭环：主/辅账务、主数据、核心用例、异常与审批、撤销/冲销/回滚流程完成；跨模块依赖用例打通。
- 数据一致性：领域事件/CDC 覆盖，幂等与重放验证，关键对账（主数据、库存、财务、信用、薪资）通过。
- 性能与容量：上述基准达标（接口 p99、批处理窗口、队列滞留、缓存命中、QPS 余量）。
- 安全与合规：RBAC/ABAC、生效/过期策略、隐私/同意（含审计留存）、分离职责检查、渗透/安全扫描。
- 可观测与运维：指标/日志/追踪上线，SLO/告警路由生效，Runbook/回滚预案验证；CI/CD、迁移脚本、种子数据完备。
- 报表与数据：运营/法定报表上线，自助查询/语义层可用；数据质量规则与告警上线；数仓/事件采集对齐。
- 培训与文档：ADR、接口/事件清单、配置指南、运维手册、用户培训材料完成；上线前演练完成。

## 首波次（0-2）验收样例
- 波次 0（平台/MDG/GRC/IAM）
  - SSO/OIDC、RBAC/ABAC、职责分离策略及审计通过；API 网关限流/签名/审计生效。
  - 主数据域（BP/物料/科目/组织/成本中心/税码/UoM）建模完成，变更事件与缓存一致性验证；数据质量评分机制上线。
  - 备份/恢复演练通过，可观测性基线（日志/指标/追踪）部署完成。
- 波次 1（FI）
  - 多账簿/多币种凭证过账、税务计算、期间/年度结账、支付运行、资产折旧、AR/AP 账龄/催款闭环通过。
  - 与 MM/SD 对账（GR/IR、开票）、期初余额导入双账验证通过；关账批次窗口可接受。
  - 财务三大表/账龄/税表/审计日志可用，审批与影像归档生效。
- 波次 2（TR/FSCM）
  - 现金池/头寸/流动性预测、付款工厂运行；信用额度/评分/放行、催收与争议闭环。
  - 外汇/利率/衍生品交易生命周期与会计处理、对冲与套期会计；银行接口（指令/回执/对账）稳定。
  - DSO/DPO、信用暴露、流动性滚动报表可用；KYC/AML 钩子与双人复核生效。

## API/事件命名与版本化简约规范
- REST：`/api/{domain}/{resource}`，使用语义版本 `/v1`；写接口幂等键用 `Idempotency-Key`；错误码对齐 API 设计文档。
- gRPC：包名 `{domain}.{service}.v1`，方法名动词化；拦截器统一鉴权/审计/幂等。
- 事件：主题命名 `erp.{domain}.{event}`，事件版本字段 `event_version`，幂等键 `event_id`；事件 Schema 版本化与向后兼容；重试/死信/重放策略清晰。

## 工具与产物建议
- 配置/密钥：ConfigMap/Secret 管理与分环境覆盖，密钥轮换策略。
- 数据：Migration/Seed 脚本、对账脚本、数据脱敏脚本；批处理编排（如 Argo/Airflow）模板。
- 测试：契约测试（HTTP/gRPC/事件），模拟数据与金丝雀数据集；性能/压测脚本。
- 部署：Helm/Manifest 与 Kustomize 模板、灰度与回滚脚本、混沌演练脚本（可选）。
- 报表：法定/管理报表模板，语义层/指标定义文件，数据血缘/质量仪表盘。

## 波次关键用例/接口/报表参考（精简版）
- 波次 3（CO）
  - 用例：成本中心/内部订单创建与审批；标准成本估算与发布；作业分配/分摊；WIP 与差异结算；CO-PA 分段报表。
  - 接口/事件：`/co/cost-centers`，`/co/internal-orders`，`/co/allocations/run`，事件 `erp.co.allocation.completed`。
  - 报表：成本中心/内部订单成本报表，差异分析，盈利能力分段。
- 波次 4（MM）
  - 用例：供应商资格/黑名单；RFQ→PO→合同；收货/退货；盘点；三单匹配与差异处理；寄售/委外。
  - 接口/事件：`/mm/vendors`，`/mm/rfq`，`/mm/purchase-orders`，`/mm/gr`，`/mm/invoices`；事件 `erp.mm.gr.posted`，`erp.mm.invoice.matched`。
  - 报表：采购周期/准时率、供应商评分、库存周转/安全库存。
- 波次 5（SD）
  - 用例：报价/订单/变更；ATP 承诺；部分发货/开票；退换/拒收；信用检查。
  - 接口/事件：`/sd/quotes`，`/sd/orders`，`/sd/atp`，`/sd/deliveries`，`/sd/invoices`；事件 `erp.sd.order.created`，`erp.sd.delivery.shipped`，`erp.sd.invoice.issued`。
  - 报表：履约率、毛利/净利、信用暴露、退货率。
- 波次 6（PP）
  - 用例：BOM/工艺版本；MRP 与例外；生产订单/工单派工与报工；批次追溯；替代料与并行/交叉工序。
  - 接口/事件：`/pp/boms`，`/pp/routings`，`/pp/mrp/run`，`/pp/orders`，`/pp/operations/confirm`；事件 `erp.pp.mrp.completed`，`erp.pp.order.completed`。
  - 报表：计划达成率、在制品、工序效率、齐套率。
- 波次 7（WM/EWM）
  - 用例：上架/拣货/移库/盘点；波次与任务分配；越库、VAS；场站/门禁/排队；RF 扫码。
  - 接口/事件：`/wm/warehouses`，`/wm/tasks`，`/wm/waves`，`/wm/yard/appointments`；事件 `erp.wm.task.completed`，`erp.wm.wave.released`。
  - 报表：库龄、拣货效率、盘点差异、场站吞吐。
- 波次 8（TM）
  - 用例：路线/装载优化；承运商招投标/分配；运价与合同；派车/在途/签收；运费结算。
  - 接口/事件：`/tm/shipments`，`/tm/carriers`，`/tm/rates`，`/tm/pod`；事件 `erp.tm.shipment.dispatched`，`erp.tm.pod.received`。
  - 报表：运输成本、准时率、装载率、异常率、碳排放。
- 波次 9（QM）
  - 用例：检验计划与采样；检验批/判定/处置；质量通知与 CAPA；质量证书。
  - 接口/事件：`/qm/inspection-plans`，`/qm/lots`，`/qm/defects`，`/qm/notifications`；事件 `erp.qm.lot.released`，`erp.qm.notification.closed`。
  - 报表：合格率、缺陷趋势、SPC 控制图、COPQ。
- 波次 10（PM）
  - 用例：设备/功能位置台账；预防/预测性维护计划；工单流转与备件；计量点抄表。
  - 接口/事件：`/pm/equipment`，`/pm/maintenance-plans`，`/pm/orders`，`/pm/measurements`；事件 `erp.pm.order.completed`，`erp.pm.plan.generated`。
  - 报表：MTBF/MTTR、备件消耗、停机损失、计划 vs 实际。
- 波次 11（SCM/IBP）
  - 用例：需求预测与协同；约束型供应计划；库存优化；响应与重计划；计划版本管理。
  - 接口/事件：`/ibp/forecasts`，`/ibp/supply-plans`，`/ibp/inventory-policies`，`/ibp/scenarios`；事件 `erp.ibp.plan.published`。
  - 报表：预测准确度、履约率、库存周转/缺货率、计划偏差。
- 波次 12（PS）
  - 用例：WBS/网络/里程碑；预算与承诺控制；挣值与进度；收入确认；变更与索赔。
  - 接口/事件：`/ps/projects`，`/ps/wbs`，`/ps/budgets`，`/ps/progress`，`/ps/revenue-recognition`；事件 `erp.ps.progress.updated`。
  - 报表：进度/成本偏差、现金流、里程碑达成、合同毛利。
- 波次 13（HCM）
  - 用例：组织/职位/员工主数据；考勤/请假/排班；薪资核算与分摊；绩效与招聘/培训；员工/经理自助。
  - 接口/事件：`/hcm/employees`，`/hcm/time`，`/hcm/payroll`，`/hcm/performance`，`/hcm/recruiting`；事件 `erp.hcm.payroll.posted`，`erp.hcm.time.approved`。
  - 报表：员工成本、出勤率、离职率、薪酬结构、培训与绩效指标。
- 波次 14（CRM/CX）
  - 用例：线索/商机/活动；报价与合同；服务请求/工单/现场服务；全渠道交互；电商（可选）。
  - 接口/事件：`/crm/leads`，`/crm/opportunities`，`/crm/campaigns`，`/crm/tickets`，`/crm/field-service`；事件 `erp.crm.lead.converted`，`erp.crm.ticket.closed`。
  - 报表：漏斗、活动 ROI、CSAT/NPS、SLA 达成、续约/流失。
- 波次 15（BI/BW）
  - 用例：CDC/事件/批采集；主题域模型与语义层；法定/管理/运营报表；自助分析。
  - 接口/事件：数据服务 API（按域暴露），元数据/血缘推送；事件 `erp.dw.pipeline.failed`（告警），`erp.dw.dataset.published`。
  - 报表：财务三表、P2P/O2C/库存/生产/HR/CRM 主题仪表盘与法定报表。

## 用例/接口/事件落地步骤（适用于各波次）
1) 需求分解：梳理用例→时序图/状态机→输入输出/前置后置条件→异常与补偿。
2) 契约设计：REST/gRPC/事件 Schema，幂等键与重试策略，错误码/业务码对齐，版本策略。
3) 权限与合规：鉴权/鉴别、字段脱敏、审计字段、职责分离检查点。
4) 集成矩阵：上游/下游接口清单、事件订阅发布、批处理/实时链路、超时/降级策略。
5) 数据与迁移：表结构/索引、CDC/事件映射、迁移脚本、回滚方案、对账脚本。
6) 验收用例：正向/异常/性能/安全/回滚场景，契约测试与端到端测试集。
7) 可观测性：指标/日志/追踪埋点、SLO 与告警规则、Dashboards。

## 事件载荷最小字段模板（建议）
- 元信息：`event_id`（幂等）、`event_version`、`occurred_at`（UTC）、`producer`、`correlation_id`、`trace_id`。
- 业务主体：`aggregate_type`、`aggregate_id`、`payload`（业务数据，含版本或 schema_ref）。
- 上下文：`actor`（用户/系统）、`tenant`（如多租户）、`source_system`、`ip/device`（可选）。
- 合规：`sensitivity`（PII/财务/机密）、`signature`（可选）、`retention`（留存策略标识）。

## 报表与语义层开发步骤（参考 BI/BW 波次）
1) 主题域建模：维度/事实定义、粒度与主键、历史快照策略（SCD）、与主数据对齐。
2) 数据采集：事件/CDC/批量，校验与重试，缺口补偿与重放，血缘登记。
3) 语义层：业务指标口径定义、权限（行/列/指标）、计算字段与时间智能。
4) 报表/看板：法定/管理/运营/实时，过滤与下钻，订阅与告警。
5) 数据质量：规则与阈值、DQ 告警、异常处理与回补；性能与成本优化。
6) 验收：对账（来源系统 vs 数仓 vs 报表）、性能 SLA、权限穿透测试、移动端可用性。

## 关键接口/事件字段示例（选取两条主链路）
- P2P：GR 事件 `erp.mm.gr.posted`
  - 必填：`event_id`，`event_version`，`occurred_at`，`producer`，`aggregate_type=goods_receipt`，`aggregate_id`（GR 编号），`po_id`，`po_item_id`，`material_id`，`batch`（可选），`plant`，`storage_location`，`qty`，`uom`，`valuation_price`，`currency`，`company_code`，`fiscal_year`，`gr_type`（101/102/122…），`status`（posted/blocked），`actor`。
  - 校验：幂等键=GR 编号+行；金额/数量容差；版本向后兼容。
- O2C：发票事件 `erp.sd.invoice.issued`
  - 必填：`event_id`，`aggregate_type=invoice`，`aggregate_id`（发票号），`order_id`，`customer_id`，`billing_date`，`net_amount`，`tax_amount`，`gross_amount`，`currency`，`company_code`，`fiscal_year`，`tax_code`，`payment_term`，`items`（material/qty/price/tax），`status`（issued/canceled），`actor`。
  - 校验：金额=Σ行；税额与税码匹配；重复发票防重；电子发票接口回执处理。

## 压测与容量演练模板（按模块抽样）
- P2P：GR/Invoice/Post 10-20k/小时；三单匹配批处理 1-2 小时内完成；峰值并发 200-300 tps。
- O2C：订单创建/变更 5-10k/小时；ATP 查询 p99 < 200ms；开票批次 10k+ 行内 60-90 分钟；信用检查链路压测。
- 生产/MRP：MRP 夜间批，典型 1-2h；报工/领料并发 200 tps；在制量一致性抽检。
- 仓储：波次/任务生成与完成并发 200-400 tps；RF 操作低延迟；盘点/场站高峰持续 1-2h。
- 资金：付款批次（成百上千笔）与银行回执；市场数据高频拉取；流动性预测窗口。
- HCM/薪资：薪资批次（全员）在窗口内完成；考勤入库/计算并发；隐私字段脱敏验证。
- BI：批/流同步延迟（流 < 1 分钟，批 < 30-60 分钟），报表 p95 < 2s，峰值并发查询容量。

## 对账与数据质量检查点（示例）
- 财务：总账借贷平衡；FI 与 CO/CO-PA 对齐；GR/IR 对账；TR 银行对账。
- 供应链：库存账实一致（按物料/批次/库位）；P2P 三单匹配率；O2C 订单-交付-开票-收款一致性。
- 生产：WIP/报工与领料一致；BOM 耗用差异；MRP 需求与执行反馈差异。
- 人力：薪资核算与账务分录一致；考勤与排班/请假一致；隐私字段访问审计。
- 数据仓库：源系统 vs 数仓 vs 报表的数量/金额/粒度对账；DQ 规则覆盖率。

## 后续波次验收样例（3-15）
- 3 CO：标准/实际成本计算完成；分摊/分配/结算批次在窗口内；WIP 与差异结转正确；CO-PA 报表与 FI/SD 金额对齐。
- 4 MM：P2P 闭环（RFQ→PO→GR→IV→支付），三单匹配成功率达标，差异/容差处理落地；批次/序列号库存一致；补货策略生效；供应商评分报表可用。
- 5 SD：询价/报价/订单→发货→开票→收款→退换闭环；ATP 准确度与响应时间达标；信用检查/冻结/解冻有效；毛利/退货报表正确。
- 6 PP：MRP 运行与例外清单；生产订单派工/报工/报废/替代料；批次追溯；WIP 对账；CO 成本对象结算对齐。
- 7 WM/EWM：波次/任务生成与 RF 执行；越库/VAS/场站流程跑通；库存账实抽检通过；任务/波次延迟在阈值内。
- 8 TM：路线/装载优化结果可复现；承运商分配与回执；在途跟踪与 POD；运费计算/分摊/结算完成；异常与索赔闭环。
- 9 QM：检验计划与采样规则生效；检验批结果录入与判定；质量通知→CAPA 闭环；质量证书生成；SPC/合格率报表可用。
- 10 PM：设备/功能位置台账完成；维护计划生成与工单流转；备件领用与成本归集；停机/MTBF/MTTR 指标可用；安全许可与审批有效。
- 11 SCM/IBP：预测准确度达阈值；供应/库存优化方案发布；情景/版本管理与共识计划；执行反馈闭环（计划→执行→反馈）。
- 12 PS：WBS/网络/里程碑建立；预算/承诺控制生效；挣值与进度报表；收入确认（完工百分比/完工合同）正确；变更/索赔流程。
- 13 HCM：组织/员工/职位主数据；考勤/请假审批；薪资批次与分录正确；绩效/招聘/培训流程；隐私与访问审计通过。
- 14 CRM/CX：线索→商机→合同闭环；活动/营销执行与 ROI；服务工单/SLA/现场服务；全渠道交互记录；同意与隐私偏好管理。
- 15 BI/BW：CDC/事件/批链路延迟达标；主题域语义层与权限；核心仪表盘（财务/P2P/O2C/库存/生产/HR/CRM）上线；DQ 规则与告警生效。

## 测试与验证包模板（各波次复用）
- 用例覆盖：核心正向、异常/补偿、审批/撤销/冲销、边界值、批量/并发。
- 契约测试：REST/gRPC/事件契约，Schema 兼容性测试，幂等与重放。
- 端到端：主链路（P2P/O2C/MRP/ATP/发运/付款/收款/薪资等）全程回放；跨模块数据一致性校验。
- 性能压测：接口延迟/吞吐、批处理窗口、队列堆积/回压，缓存命中。
- 数据质量：主/交易数据抽样、断言与规则，库存/账务/订单对账脚本自动化。
- 安全：鉴权/授权、越权/穿透、敏感字段脱敏、审计留痕、渗透扫描。
- 可用性与韧性：降级/熔断/重试、混沌演练（可选）、灾备切换/备份恢复。
- 验收记录：测试报告、缺陷清单、修复验证、Go/No-Go 结论。

## Cutover 简版剧本（适用于大波次上线）
1) 冻结与公告：定义冻结范围/窗口，业务公告，开关名单。
2) 备份与快照：DB 备份、配置快照、Feature Flag 状态记录。
3) 数据迁移：执行迁移/校验脚本，抽样对账，异常处理与重试策略。
4) 应用切换：灰度/流量切换（5%→25%→100%）、健康检查、回滚预案就绪。
5) 验证：烟雾（接口/事件/批处理）、关键报表、对账（库存/账务/订单/薪资等）。
6) 观察期：加强监控与值守，告警响应分级，缺陷快速通道。
7) 关闭与归档：确认上线、解冻、文档归档、经验复盘。

## 风险与兜底（高频通用项）
- 主数据不一致：主数据双轨校验、缓存失效策略、强制回源开关。
- 对账差异：对账脚本每日跑批，差异告警与人工处理 SOP。
- 批处理超时：批次分片/并行、断点续跑、容量预留与回退计划。
- 事件积压：消费速率监控、回压/限流、死信与重放流程。
- 权限与合规：职责分离规则未生效→强制阻断；审计与留存策略检查。
- 性能瓶颈：热点拆分、缓存/索引/分片、降级策略（只读/限流）。
- 切换失败：流量回切、配置回滚、数据回滚脚本预演。
